name: SkyBridgeCompass-iOS

options:
  bundleIdPrefix: com.skybridge
  deploymentTarget:
    iOS: "17.0"

packages:
  WebRTC:
    url: https://github.com/stasel/WebRTC
    from: 114.0.0

targets:
  SkyBridgeCompass-iOS:
    type: application
    platform: iOS
    info:
      path: "SkyBridgeCompassiOS/Supporting Files/Info.plist"
    sources:
      - path: SkyBridgeCompassiOS/Sources
      - path: "SkyBridgeCompassiOS/Supporting Files/LaunchScreen.storyboard"
        buildPhase: resources
      - path: SkyBridgeCompassiOS/Resources
        buildPhase: resources
    dependencies:
      - sdk: AppIntents.framework
      - package: WebRTC
        product: WebRTC
      - target: SkyBridgeCompass-Widgets
        embed: true
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.skybridge.compass.ios
        DEVELOPMENT_TEAM: YKUPL7Z869
        TARGETED_DEVICE_FAMILY: "1,2"
        INFOPLIST_FILE: "SkyBridgeCompassiOS/Supporting Files/Info.plist"
        SWIFT_STRICT_CONCURRENCY: targeted
        # Important: do NOT define HAS_APPLE_PQC_SDK by default.
        # If you have an SDK that actually contains CryptoKit PQC types (MLKEM/MLDSA),
        # add `HAS_APPLE_PQC_SDK` in Target Build Settings -> Swift Compiler - Custom Flags.

  SkyBridgeCompass-Widgets:
    type: app-extension
    platform: iOS
    info:
      path: "Widgets/Info.plist"
    sources:
      - path: Widgets
      - path: SkyBridgeCompassiOS/Sources/LiveActivities/SkyBridgeActivityAttributes.swift
    dependencies:
      - sdk: WidgetKit.framework
      - sdk: ActivityKit.framework
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.skybridge.compass.ios.widgets
        DEVELOPMENT_TEAM: YKUPL7Z869
        INFOPLIST_FILE: "Widgets/Info.plist"
        SWIFT_STRICT_CONCURRENCY: targeted
        # Widgets do not need HAS_APPLE_PQC_SDK; keep build conditions minimal for portability.

schemes:
  SkyBridgeCompass-iOS:
    build:
      targets:
        SkyBridgeCompass-iOS: all
        SkyBridgeCompass-Widgets: all
    run:
      config: Debug
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
