<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:wp14="http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing" xmlns:wp="http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing" xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml" xmlns:w10="urn:schemas-microsoft-com:office:word" xmlns:w15="http://schemas.microsoft.com/office/word/2012/wordml" xmlns:wpg="http://schemas.microsoft.com/office/word/2010/wordprocessingGroup" xmlns:wpi="http://schemas.microsoft.com/office/word/2010/wordprocessingInk" xmlns:wne="http://schemas.microsoft.com/office/word/2006/wordml" xmlns:wps="http://schemas.microsoft.com/office/word/2010/wordprocessingShape" xmlns:wpsCustomData="http://www.wps.cn/officeDocument/2013/wpsCustomData" mc:Ignorable="w14 w15 wp14"><w:body><w:p w14:paraId="01FA3BCC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>一、我认为优先级最高的几个雷（建议 P0 / P1）</w:t></w:r></w:p><w:p w14:paraId="5FCC3E9C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>1）awaitResult + @MainActor = 经典死锁雷</w:t></w:r></w:p><w:p w14:paraId="2F0C80A6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5E4F1561"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="31DAE450"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="70BE3171"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Sources/SkyBridgeCore/Security/P2PSecurityManager.swift</w:t></w:r></w:p><w:p w14:paraId="27E41882"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="71C09608"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2PSecurityManager 整个类是 @MainActor</w:t></w:r></w:p><w:p w14:paraId="3155906F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="51A5556A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>establishSessionKey 里调用：</w:t></w:r></w:p><w:p w14:paraId="197C1EB9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0B0719C9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>let enc = try awaitResult { try await provider.kemEncapsulate(...) }</w:t></w:r></w:p><w:p w14:paraId="1CEA726F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>let ss2 = try awaitResult { try await provider.kemDecapsulate(...) }</w:t></w:r></w:p><w:p w14:paraId="10CA4C89"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="01FDCBE6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1AA04413"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>awaitResult 定义：</w:t></w:r></w:p><w:p w14:paraId="6B1AE031"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6AB398D7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>private func awaitResult&lt;T&gt;(_ body: @escaping () async throws -&gt; T) throws -&gt; T {</w:t></w:r></w:p><w:p w14:paraId="50ADED51"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let g = DispatchGroup()</w:t></w:r></w:p><w:p w14:paraId="3E3C4030"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    g.enter()</w:t></w:r></w:p><w:p w14:paraId="31D6C2D1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    var result: Result&lt;T, Error&gt;!</w:t></w:r></w:p><w:p w14:paraId="1D71FB70"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    Task { @MainActor in</w:t></w:r></w:p><w:p w14:paraId="22719BC3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        do { let v = try await body(); result = .success(v) } catch { result = .failure(error) }</w:t></w:r></w:p><w:p w14:paraId="5E718B0A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        g.leave()</w:t></w:r></w:p><w:p w14:paraId="31A621DA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="019F0742"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    g.wait()</w:t></w:r></w:p><w:p w14:paraId="38C59550"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    switch result! {</w:t></w:r></w:p><w:p w14:paraId="25CB89C4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    case .success(let v): return v</w:t></w:r></w:p><w:p w14:paraId="02196671"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    case .failure(let e): throw e</w:t></w:r></w:p><w:p w14:paraId="60A2E367"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="5D2B7ED1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="79DFB4FF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="77C8735A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="23AF5929"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="30A3FA93"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7B486556"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2PSecurityManager 是 @MainActor，establishSessionKey 也是在 MainActor 上执行。</w:t></w:r></w:p><w:p w14:paraId="123C05BF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="46EC4A52"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>里面开了一个 Task { @MainActor in ... }，然后当前线程（同一个 MainActor）立刻 g.wait() 阻塞。</w:t></w:r></w:p><w:p w14:paraId="11797743"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5D22CD54"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>MainActor 被 g.wait() 卡住了，新建的 Task { @MainActor ... } 永远没有机会在 MainActor 上跑，g.leave() 永远不会调用，100% 死锁。</w:t></w:r></w:p><w:p w14:paraId="1BCC233F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="33FE609A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>只要在真实路径上调用 establishSessionKey，UI 就直接卡死，不是“理论风险”，而是典型死锁模式。</w:t></w:r></w:p><w:p w14:paraId="25A073C3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="09C89F07"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>建议修法（方向）：</w:t></w:r></w:p><w:p w14:paraId="0C607CE2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="14C3BD5F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>要么：把 QuantumCryptoManager / PQCProvider 的调用改成彻底 async，establishSessionKey 本身标记为 async throws，上层用 await，别再搞同步封装。</w:t></w:r></w:p><w:p w14:paraId="2F9DDB92"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="62E38F18"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>要么：这个同步封装必须在非 MainActor 上做，比如：</w:t></w:r></w:p><w:p w14:paraId="0D7F8E2E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="57DC16BA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>把 awaitResult 搬到 nonisolated / 非 @MainActor 的 helper 里；</w:t></w:r></w:p><w:p w14:paraId="451F406D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="41D4E217"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Task { ... } 不要再标记 @MainActor，让它在后台 executor 跑，然后当前线程阻塞。但这也不优雅。</w:t></w:r></w:p><w:p w14:paraId="70908E98"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="159DA937"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>总体建议：干脆删掉 awaitResult 这一套，PQC 协商全链路改 async，比现在这个“MainActor + DispatchGroup”组合健康太多。</w:t></w:r></w:p><w:p w14:paraId="0858ACDF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="39D3C576"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>2）SSH 仍然是「接受所有 HostKey」——安全性完全靠天</w:t></w:r></w:p><w:p w14:paraId="2E634108"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0B15DAD5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="19262F41"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4F6A2FD8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Sources/SkyBridgeCore/RemoteConnection/SSHSession.swift</w:t></w:r></w:p><w:p w14:paraId="0A9F490C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5C8F7BCA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>有个委托：</w:t></w:r></w:p><w:p w14:paraId="4639AE27"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1DB5424A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>final class AcceptAllHostKeysDelegate: NIOSSHClientServerAuthenticationDelegate {</w:t></w:r></w:p><w:p w14:paraId="12F69A37"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    func validateHostKey(hostKey: NIOSSHPublicKey, validationCompletePromise: EventLoopPromise&lt;Void&gt;) {</w:t></w:r></w:p><w:p w14:paraId="14008C8C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        validationCompletePromise.succeed(())</w:t></w:r></w:p><w:p w14:paraId="5774CC3A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="3C7F7483"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="6B158330"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="443B02C0"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="31D09E84"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>并且在建立连接时多处：</w:t></w:r></w:p><w:p w14:paraId="0818F68D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="64C1E672"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>let hostKeyDelegate = AcceptAllHostKeysDelegate()</w:t></w:r></w:p><w:p w14:paraId="13D237D2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2BB65374"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="56DB82CE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="2E080808"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7D9D252E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这就是字面意义的“任何服务器公钥都信任”。</w:t></w:r></w:p><w:p w14:paraId="10380DF6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="70C165B4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>生产环境相当于完全没有主机身份校验，MITM / DNS 劫持 = 透明成功。</w:t></w:r></w:p><w:p w14:paraId="448A878E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="101D62E3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>建议：</w:t></w:r></w:p><w:p w14:paraId="4AD71046"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="39B762EC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>至少要有一个「开发模式 / Debug 开关」，默认关闭 AcceptAllHostKeysDelegate。</w:t></w:r></w:p><w:p w14:paraId="718BFEC6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4238614D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>正常模式下走：</w:t></w:r></w:p><w:p w14:paraId="198ED1BE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="13384421"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>本地 known_hosts 风格存储；</w:t></w:r></w:p><w:p w14:paraId="0225AAAC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="14BE866F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>或者你自己的「信任设备公钥表」（你已经有 P2P / Supabase 信任体系了，完全可以统一）。</w:t></w:r></w:p><w:p w14:paraId="1C44D1FC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2A7A3EFE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>3）AQI 接口里用的是硬编码 demo key</w:t></w:r></w:p><w:p w14:paraId="5429590A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="43FE9D7B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="4F91EF82"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5546A1E3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Sources/SkyBridgeCore/Weather/WeatherService.swift</w:t></w:r></w:p><w:p w14:paraId="00C8A8D6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0F7F5EBA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>代码片段：</w:t></w:r></w:p><w:p w14:paraId="7F0F68B3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2B12DF1F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>// OpenWeatherMap</w:t></w:r></w:p><w:p w14:paraId="39EF309B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>let urlString = &quot;https://api.openweathermap.org/data/2.5/air_pollution?lat=\(latitude)&amp;lon=\(longitude)&amp;appid=demo_key&quot;</w:t></w:r></w:p><w:p w14:paraId="0ADA88F6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="49696C5F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>// WAQI</w:t></w:r></w:p><w:p w14:paraId="2ED07050"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>let urlString = &quot;https://api.waqi.info/feed/geo:\(latitude);\(longitude)/?token=demo&quot;</w:t></w:r></w:p><w:p w14:paraId="11602701"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="202FC725"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6CCFE017"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="3D87757B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1391D6E9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这两个 demo_key / token=demo 在真实环境下基本等于不可用，或者马上 hit rate limit。</w:t></w:r></w:p><w:p w14:paraId="78848B25"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7982A69E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>而当前 AQI 逻辑是：</w:t></w:r></w:p><w:p w14:paraId="518468B4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5F651256"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>OWM；</w:t></w:r></w:p><w:p w14:paraId="53569C78"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="29E16254"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WAQI；</w:t></w:r></w:p><w:p w14:paraId="7641837B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="49E3328B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>再 fallback 能见度估算。</w:t></w:r></w:p><w:p w14:paraId="5364C72A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="57202AE0"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>只要联网环境正常，这两个请求会稳定失败 + 白白占用网络与日志。</w:t></w:r></w:p><w:p w14:paraId="3E18E0AA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>上线前必须：</w:t></w:r></w:p><w:p w14:paraId="78F0C341"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="050D3C93"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>换成从 APIKeyManagementView / 配置中心读的真实 key；</w:t></w:r></w:p><w:p w14:paraId="05AC9FAB"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1B6D5E47"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>或在没有 key 的情况下直接跳过外部 API，避免对外乱打 demo endpoint。</w:t></w:r></w:p><w:p w14:paraId="783DA12B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1B7AC021"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>4）PQC / HPKE：OQSProvider 的 HPKE 完全未集成</w:t></w:r></w:p><w:p w14:paraId="435F30E4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6D36BF4C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="424D6F4E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6E70B54C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Sources/SkyBridgeCore/QuantumSecure/PQCProvider.swift</w:t></w:r></w:p><w:p w14:paraId="303ED9BF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="199E8B55"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>摘关键几行：</w:t></w:r></w:p><w:p w14:paraId="494769D9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2CA1B01B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>func hpkeSeal(...) async throws -&gt; (ciphertext: Data, encapsulatedKey: Data) {</w:t></w:r></w:p><w:p w14:paraId="3FDFBAC1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    throw NSError(domain: &quot;PQC&quot;, code: -104, userInfo: [NSLocalizedDescriptionKey: &quot;oqs-provider 尚未集成&quot;])</w:t></w:r></w:p><w:p w14:paraId="24D4327A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="5FD93E45"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>func hpkeOpen(...) async throws -&gt; Data {</w:t></w:r></w:p><w:p w14:paraId="7BCA9546"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    throw NSError(domain: &quot;PQC&quot;, code: -105, userInfo: [NSLocalizedDescriptionKey: &quot;oqs-provider 尚未集成&quot;])</w:t></w:r></w:p><w:p w14:paraId="3B9BE258"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="53049694"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="547FEC5B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="49F077E7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>以及：</w:t></w:r></w:p><w:p w14:paraId="1E884130"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="58599FFC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>@available(macOS 14.0, *)</w:t></w:r></w:p><w:p w14:paraId="07BA98AC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>extension OQSProvider: PQCHPKEProvider {</w:t></w:r></w:p><w:p w14:paraId="70AA5BE9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    func senderContext(...) throws -&gt; HPKESenderContext {</w:t></w:r></w:p><w:p w14:paraId="419DDB25"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        throw NSError(domain: &quot;PQC&quot;, code: -903, userInfo: [NSLocalizedDescriptionKey: &quot;HPKE unsupported in OQSProvider&quot;])</w:t></w:r></w:p><w:p w14:paraId="1B46EEA1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="228FE761"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    func recipientContext(...) throws -&gt; HPKERecipientContext {</w:t></w:r></w:p><w:p w14:paraId="43E5C6A2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        throw NSError(domain: &quot;PQC&quot;, code: -904, userInfo: [NSLocalizedDescriptionKey: &quot;HPKE unsupported in OQSProvider&quot;])</w:t></w:r></w:p><w:p w14:paraId="3FB0E016"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="40DEDAA9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="62E0F8B7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="78C8A520"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6A89E607"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="226F43A7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0259787D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>只要哪条路径在 OQS 后端上错误地调用了 HPKE，就是直接抛异常。</w:t></w:r></w:p><w:p w14:paraId="48BC289A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="318B1BFD"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>好消息是：目前看调用方大多还停留在“示例 / 预留”，真正会话协商更多是 AES-GCM + KEM。</w:t></w:r></w:p><w:p w14:paraId="3877575D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="48A839C8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>要求：</w:t></w:r></w:p><w:p w14:paraId="2839BCFE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="321D4CA5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>必须保证所有生产路径在选择 HPKE 时明确区分 backend：</w:t></w:r></w:p><w:p w14:paraId="2CD4E1C0"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="41C8412F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>backend == .applePQC 才允许走 HPKE；</w:t></w:r></w:p><w:p w14:paraId="49DE22EF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="703668D8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>liboqs 必须明确“不支持 HPKE”，不要走这条代码。</w:t></w:r></w:p><w:p w14:paraId="63937359"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="709FC534"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>你已经有 PQCBackend / PQCAlgorithmSuite 之类的枚举，把这层判断做到所有入口之前就行。</w:t></w:r></w:p><w:p w14:paraId="4977D201"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="57B916BC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>二、加密 / 协议层的“半成品”与潜在逻辑坑</w:t></w:r></w:p><w:p w14:paraId="2CFE1894"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>5）P2P 会话密钥协商：KEM 使用方式还是“本机演示级”的</w:t></w:r></w:p><w:p w14:paraId="3F6B5C5F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6BDD90CE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="2851B524"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6BD93353"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2PSecurityManager.establishSessionKey(with:publicKey:)</w:t></w:r></w:p><w:p w14:paraId="742FFF40"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3E7ABE32"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>逻辑大概是：</w:t></w:r></w:p><w:p w14:paraId="0D5FD89D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="67E5C6F2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>if let provider = PQCProviderFactory.makeProvider() {</w:t></w:r></w:p><w:p w14:paraId="5DA8184C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let enc = try awaitResult { try await provider.kemEncapsulate(peerId: deviceId, kemVariant: &quot;ML-KEM-768&quot;) }</w:t></w:r></w:p><w:p w14:paraId="05FF13FB"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let ss2 = try awaitResult { try await provider.kemDecapsulate(peerId: deviceId, encapsulated: enc.encapsulated, kemVariant: &quot;ML-KEM-768&quot;) }</w:t></w:r></w:p><w:p w14:paraId="0C305EF4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    // 然后基于 ss2 / P256 HKDF 派生 sessionKey</w:t></w:r></w:p><w:p w14:paraId="53B9FFD9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="1921EDDC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="39F2B428"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5100019E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>配套注释：</w:t></w:r></w:p><w:p w14:paraId="6ACBAF67"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0493CA3B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>注意：此处为简化演示，真实场景需通过上层信令交换对端公钥标签</w:t></w:r></w:p><w:p w14:paraId="21CACA08"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="53E88825"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="40E2B29A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3F04E153"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>现在这一套，其实是在同一进程里既封装又解封，更像“自测”，而不是跨设备协商。</w:t></w:r></w:p><w:p w14:paraId="7923F1F8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3DC9E29E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>真正的流程应该是：</w:t></w:r></w:p><w:p w14:paraId="63BFAED4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1098883C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>A：拿 B 的公钥 / 标记 → 调 kemEncapsulate → 发送 encapsulated 给 B；</w:t></w:r></w:p><w:p w14:paraId="4A8EF62B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4DCA9C8B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>B：基于自己私钥 + 收到的 encapsulated → kemDecapsulate → 得到共享密钥；</w:t></w:r></w:p><w:p w14:paraId="64C428E7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="76E1304E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>双方再各自派生对称密钥。</w:t></w:r></w:p><w:p w14:paraId="64F512AC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="675274A7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>目前这段代码没有看见消息传递层的参与，看起来是“把 liboqs 当作一个伪随机源”，而不是实际和对端对齐。</w:t></w:r></w:p><w:p w14:paraId="7918AC75"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1472EF4E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>建议：</w:t></w:r></w:p><w:p w14:paraId="42CAB1CE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="20D60881"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>把这段逻辑挪到“真正的 P2P handshake 层”，让 P2PSecurityManager 只提供：</w:t></w:r></w:p><w:p w14:paraId="2C0E270B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6FE7D222"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>func kemEncapsulate(peerId: String, suite: ...) async throws -&gt; (ss: Data, enc: Data)</w:t></w:r></w:p><w:p w14:paraId="664D4632"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7C226447"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>func kemDecapsulate(peerId: String, enc: Data, suite: ...) async throws -&gt; Data</w:t></w:r></w:p><w:p w14:paraId="23F9BAB5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5FDD25CD"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>上层握手负责把 enc 在两端传过去，不要在一个函数里把封装 + 解封都做掉。</w:t></w:r></w:p><w:p w14:paraId="46EF5E88"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0DC02756"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>6）Apple PQC 类型仍然是“猜 API 名字”的占位写法</w:t></w:r></w:p><w:p w14:paraId="27974796"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="30BA19F7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>例子：</w:t></w:r></w:p><w:p w14:paraId="3353C24C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3077FDDE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>QuantumCryptoManager.generateHPKEKeyPair()：</w:t></w:r></w:p><w:p w14:paraId="79C5CA22"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="27864F57"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>@available(macOS 26.0, *)</w:t></w:r></w:p><w:p w14:paraId="243DA38E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>public static func generateHPKEKeyPair() throws -&gt; (privateKey: XWingMLKEM768X25519.PrivateKey, publicKey: XWingMLKEM768X25519.PublicKey) {</w:t></w:r></w:p><w:p w14:paraId="3951720A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    // 注意：API 可能是 generate() 或 init()，根据实际文档调整</w:t></w:r></w:p><w:p w14:paraId="1FDED9CE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let privateKey = try XWingMLKEM768X25519.PrivateKey.generate()</w:t></w:r></w:p><w:p w14:paraId="6DE62C93"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let publicKey = privateKey.publicKey</w:t></w:r></w:p><w:p w14:paraId="0505DF0C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    return (privateKey, publicKey)</w:t></w:r></w:p><w:p w14:paraId="5E122DA2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="4A1EED62"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4B7BA01D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4B262C47"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>以及 UltraStream / ApplePQCProvider 里类似的 HPKE.Sender(... ciphersuite: .XWingMLKEM768X25519_SHA256_AES_GCM_256, ...)。</w:t></w:r></w:p><w:p w14:paraId="7B9C51E1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2E00AFBA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>事实：</w:t></w:r></w:p><w:p w14:paraId="75DE2069"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6FEA8CA4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这里明确写着“API 可能是 generate() 或 init()”，说明这部分代码本身就是基于未来文档的猜测。</w:t></w:r></w:p><w:p w14:paraId="507279EA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="72926869"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>编译能不能过，完全取决于 Apple 最终 API 是否刚好这么设计；现在这就是典型“未来占位”。</w:t></w:r></w:p><w:p w14:paraId="25FFBC26"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="51B015C8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>建议：</w:t></w:r></w:p><w:p w14:paraId="342EF2D5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1294F17F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>保留结构没问题，但要在代码里明确标记为占位（目前有注释，但你自己未来会忘）。</w:t></w:r></w:p><w:p w14:paraId="6D17AE06"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="29EF279A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>真正上 Xcode 新 SDK 之后，要做一次通篇对照 Apple 文档：</w:t></w:r></w:p><w:p w14:paraId="5D886E99"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6C48C166"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>类型名是否一致；</w:t></w:r></w:p><w:p w14:paraId="2559238A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3BD0130E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>ciphersuite enum 名是否一致；</w:t></w:r></w:p><w:p w14:paraId="663DDB06"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1776B08D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>integrityCheckedRepresentation 等序列化接口是否存在 / 是否改名。</w:t></w:r></w:p><w:p w14:paraId="67EFD15C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3E7B2773"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>在那之前，把这些代码当成“只在 macOS 26 + 最新 SDK 下启用的 feature branch”，不要期望它在当前环境跑。</w:t></w:r></w:p><w:p w14:paraId="4DEA294F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5EC51171"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>三、功能级 / UX 级的“残缺”和占位</w:t></w:r></w:p><w:p w14:paraId="6668C31E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="178F1070"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这些不是立刻爆炸，但会导致体验不完整，或者安全性减分。</w:t></w:r></w:p><w:p w14:paraId="040B1721"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0BDDCC21"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>7）P2P 手动连接：publicKey 为空的占位</w:t></w:r></w:p><w:p w14:paraId="6212FFA4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0759E74A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="3AAFDA4F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4FDA78BF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2PConnectionView.swift：</w:t></w:r></w:p><w:p w14:paraId="10125AFF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3D3235CC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>ManualConnectSheet { host, port, name, type in</w:t></w:r></w:p><w:p w14:paraId="6A320B88"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    // 构造最小设备信息并发起连接（公钥为空为占位）</w:t></w:r></w:p><w:p w14:paraId="57327E1E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    let device = P2PDevice(</w:t></w:r></w:p><w:p w14:paraId="69EC5121"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        id: UUID().uuidString,</w:t></w:r></w:p><w:p w14:paraId="71F88CE4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        name: name,</w:t></w:r></w:p><w:p w14:paraId="33FB91E6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        type: type,</w:t></w:r></w:p><w:p w14:paraId="45D44A61"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        address: host,</w:t></w:r></w:p><w:p w14:paraId="778F456A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        port: port,</w:t></w:r></w:p><w:p w14:paraId="4892CBFA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        ...</w:t></w:r></w:p><w:p w14:paraId="1FE7B7C6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        pubKeyFingerprint: nil,</w:t></w:r></w:p><w:p w14:paraId="17E1693C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        macAddresses: nil</w:t></w:r></w:p><w:p w14:paraId="7E160D2E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    )</w:t></w:r></w:p><w:p w14:paraId="1B92F52F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    onConnect(device)</w:t></w:r></w:p><w:p w14:paraId="0C6DD556"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="04404AD8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="010A2ECA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1E63D8E5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>问题：</w:t></w:r></w:p><w:p w14:paraId="1C1C30C9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1DE845E7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>手动添加设备时，完全没有 P-256 公钥 / 指纹，和你前面那套“强身份 / 量子加密信任体系”完全脱节。</w:t></w:r></w:p><w:p w14:paraId="526A4E82"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5524D7BA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>如果上层默认把这类设备也当作“信任设备”，那就相当于开了一个无身份验证的后门。</w:t></w:r></w:p><w:p w14:paraId="632A2851"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="131A12C2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>建议：</w:t></w:r></w:p><w:p w14:paraId="06990437"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1C1B67C4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>至少 UI 上要标清楚：“未验证设备 / 手动设备”；安全策略上不允许它享受 full-trust。</w:t></w:r></w:p><w:p w14:paraId="2C896F39"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="37D784FF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>更理想的是：手动添加也要求用户贴入一个 fingerprint / 设备 token，让 P2PSecurityManager 可以在第一次连接时校验。</w:t></w:r></w:p><w:p w14:paraId="587C5000"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="43435718"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>8）Weather / DynamicWallpaper：功能逻辑基本 ok，但模型 / 效果部分仍然简化</w:t></w:r></w:p><w:p w14:paraId="643474A7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="54A61400"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>好的一面：</w:t></w:r></w:p><w:p w14:paraId="1CCB780D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="3ABF3314"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WeatherMLPredictor.loadMLModel() 现在是：</w:t></w:r></w:p><w:p w14:paraId="457A0C50"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6CA8BEA1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>if let modelURL = Bundle.main.url(forResource: &quot;WeatherPredictionModel&quot;, withExtension: &quot;mlmodelc&quot;) {</w:t></w:r></w:p><w:p w14:paraId="3DD64FA0"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    self.mlModel = try MLModel(contentsOf: modelURL)</w:t></w:r></w:p><w:p w14:paraId="0E867AA1"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    backend = CoreMLBackend(model: self.mlModel)</w:t></w:r></w:p><w:p w14:paraId="45743454"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>} else {</w:t></w:r></w:p><w:p w14:paraId="0A98DD22"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    self.mlModel = nil</w:t></w:r></w:p><w:p w14:paraId="0CA1A19C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    backend = RuleEngineBackend()</w:t></w:r></w:p><w:p w14:paraId="6E56C369"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="22A60F4A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5623EDCE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="660C9C10"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这已经是我之前建议的“有模型用模型，无模型走规则引擎”，不会再因为假模型崩溃。</w:t></w:r></w:p><w:p w14:paraId="3F3C65B8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="05BAA207"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>DynamicWallpaperManager 初始化里对 MetalFX 也做了 family 检测，旧设备上优雅降级。</w:t></w:r></w:p><w:p w14:paraId="35F2753A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0097D090"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>残留的小问题：</w:t></w:r></w:p><w:p w14:paraId="1EB63708"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6A7B64C3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WeatherMLPredictor 里 createMockMLModel() 还在，是彻底没用到的占位函数，可以考虑删掉，减噪。</w:t></w:r></w:p><w:p w14:paraId="261DEB42"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6249675B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WeatherEffectView 里各种 “简化占位符（由 DashboardView 处理完整效果）” 的注释还在，说明视觉效果还没完全对齐最终设计——不算 bug，只是还没完工。</w:t></w:r></w:p><w:p w14:paraId="4597A96A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7601F192"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>9）UltraStream 的 HPKE 协议是“示例层”</w:t></w:r></w:p><w:p w14:paraId="74E6158F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="724FFF6B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>位置：</w:t></w:r></w:p><w:p w14:paraId="228EE405"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2EC39C7D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>UltraStream/UltraStream.swift 底部的：</w:t></w:r></w:p><w:p w14:paraId="0B992D0A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="0E55DD21"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>// MARK: - PQC HPKE X-Wing 会话密钥协商（示例层）</w:t></w:r></w:p><w:p w14:paraId="5A2743CD"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>// ...</w:t></w:r></w:p><w:p w14:paraId="60EB8C47"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>public enum UltraStreamKeyAgreement { ... }</w:t></w:r></w:p><w:p w14:paraId="0574A44A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="58A84CFE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="19DAD3D2"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>里面说明也写得很清楚，是“演示如何用 CryptoKit HPKE + XWingMLKEM768X25519 生成会话对称密钥”。</w:t></w:r></w:p><w:p w14:paraId="555957E4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="16101D15"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>现状：</w:t></w:r></w:p><w:p w14:paraId="41F62E6F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="534045B9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这块现在没真正接到 UltraStream 的生产握手里，只是一个工具 / 示例。</w:t></w:r></w:p><w:p w14:paraId="6FD3CC04"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="7D8B004A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>不会直接炸，但也不能当成“已经有了完整会话协商”。</w:t></w:r></w:p><w:p w14:paraId="541A82AE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="65827E29"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>10）杂项占位 / 示例</w:t></w:r></w:p><w:p w14:paraId="09175393"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="45186DB8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这些更多是“代码还没完工”的信号，不是炸弹：</w:t></w:r></w:p><w:p w14:paraId="6CDD77CC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5A3F1452"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>QuantumBeam struct 明确写着“占位符实现”；</w:t></w:r></w:p><w:p w14:paraId="7C53EF04"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="45EE7231"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>EnhancedDeviceDiscovery 只是个空壳（startScanning 里没真正扫描逻辑）；</w:t></w:r></w:p><w:p w14:paraId="70A0268D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="47EAE700"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>PreferencesView 用的 skybridge.example.com / support@skybridge.example.com 还没换成真实域名；</w:t></w:r></w:p><w:p w14:paraId="3B0BFED4"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="285AF129"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>OQSRAIISample / PQCKeyMigrationTool 就是纯 sample / tool，不会被主流程调用。</w:t></w:r></w:p><w:p w14:paraId="5B0AF1C5"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="6BE671FD"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>四、已经明显改善 / 修掉的点（顺便给你一个 sanity check）</w:t></w:r></w:p><w:p w14:paraId="461F498D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5C40B0CA"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>为了避免你怀疑我没看之前那堆：</w:t></w:r></w:p><w:p w14:paraId="18580346"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="16DF111E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>BGRA 内存生命周期问题</w:t></w:r></w:p><w:p w14:paraId="3777ED14"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="685E945D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>Metal4EnhancedRenderer.renderBGRAFrame 已经统一走 BGRAFrameBuilder.buildPixelBuffer(...)；</w:t></w:r></w:p><w:p w14:paraId="253259B6"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="476F86D8"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>BGRAFrameBuilder 的 .safeCopy 是标准 CVPixelBufferCreate + memcpy，.zeroCopy 目前明确抛 zeroCopyNotImplemented；</w:t></w:r></w:p><w:p w14:paraId="1E9275DF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="5E0E6EAD"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>之前那个 CVPixelBufferCreateWithBytes + Data 绑定异步纹理的悬挂指针问题，已经消失，这是实打实的提升。</w:t></w:r></w:p><w:p w14:paraId="23F81777"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2B6D305E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>TLS Identity 类型检查</w:t></w:r></w:p><w:p w14:paraId="19F03618"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="61517094"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>TLSSecurityManager.createServerListener 里新增：</w:t></w:r></w:p><w:p w14:paraId="748170FB"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="2A985D6C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>if let identity = certificateManager.getIdentity(for: deviceId) {</w:t></w:r></w:p><w:p w14:paraId="771A2898"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    if CFGetTypeID(identity) == SecIdentityGetTypeID() {</w:t></w:r></w:p><w:p w14:paraId="7F40008B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        let secIdentity = sec_identity_create(identity)</w:t></w:r></w:p><w:p w14:paraId="6C91A7FE"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        if let secIdentity = secIdentity {</w:t></w:r></w:p><w:p w14:paraId="700D6B25"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">            sec_protocol_options_set_local_identity(secOptions, secIdentity)</w:t></w:r></w:p><w:p w14:paraId="06218C3A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">        }</w:t></w:r></w:p><w:p w14:paraId="39F49E5E"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t xml:space="preserve">    }</w:t></w:r></w:p><w:p w14:paraId="39F7725D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>}</w:t></w:r></w:p><w:p w14:paraId="55B5A40C"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="22AAB361"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="780F0C9A"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这就是我们前面讨论的 S1 增强，已经落地。</w:t></w:r></w:p><w:p w14:paraId="173DA934"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="4716EFD7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WeatherMLPredictor 真实模型 + 规则回退</w:t></w:r></w:p><w:p w14:paraId="52EC010D"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="79C69ABF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>不再企图构造一个假的 MLModel(contentsOf: Bundle.main.bundleURL)，而是显式 nil + RuleEngine，干净多了。</w:t></w:r></w:p><w:p w14:paraId="55F4255B"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="39A6EFDC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>这些地方我确认过，确实比你之前那版“更安全、更稳”。</w:t></w:r></w:p><w:p w14:paraId="0C14DD30"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="1F61FCEF"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>总结一句人话</w:t></w:r></w:p><w:p w14:paraId="7C778CA7"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="55EF71C3"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>真雷：</w:t></w:r></w:p><w:p w14:paraId="165C028F"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2PSecurityManager.awaitResult 死锁风险、SSH 全信任 HostKey、AQI demo key、OQS HPKE 未集成但接口已暴露 —— 这几个要优先收拾。</w:t></w:r></w:p><w:p w14:paraId="679A8940"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="184FFABC"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>半成品：</w:t></w:r></w:p><w:p w14:paraId="5AF405F9"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>P2P 会话 KEM 流程（本机自嗨）、Apple PQC/HPKE 的类型 &amp; API 依然是“预测未来文档”的写法 —— 这些等你手里有最新 Xcode / 文档时，一次性对表修正。</w:t></w:r></w:p><w:p w14:paraId="1A7FCF42"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr></w:p><w:p w14:paraId="57B00248"><w:pPr><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>无伤占位：</w:t></w:r></w:p><w:p w14:paraId="39161DD9"><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>WeatherEffect、QuantumBeam、UltraStreamKeyAgreement 示例层、若干 example 域名——更多是 Roadmap 的提醒，不是炸弹。</w:t></w:r><w:bookmarkStart w:id="0" w:name="_GoBack"/><w:bookmarkEnd w:id="0"/></w:p><w:sectPr><w:pgSz w:w="11906" w:h="16838"/><w:pgMar w:top="1440" w:right="1800" w:bottom="1440" w:left="1800" w:header="851" w:footer="992" w:gutter="0"/><w:cols w:space="425" w:num="1"/><w:docGrid w:type="lines" w:linePitch="312" w:charSpace="0"/></w:sectPr></w:body></w:document>